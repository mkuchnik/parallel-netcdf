#
# Copyright (C) 2013, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH = @srcdir@

# generated by configure, so it's in the build dir, not srcdirr
include ../../macros.make

# F90FLAGS = @FC_DEFINE@MPI_OFFSET_KIND=@SIZEOF_MPI_OFFSET@

INCLUDES = -I. -I$(srcdir)/../lib -I../lib

LIBRARY = ../lib/libpnetcdf.a
MANUAL	=

PNETCDF_MOD = pnetcdf.mod
ifeq (@UPPER_CASE_MOD@, yes)
  PNETCDF_MOD = PNETCDF.mod
endif

M4_SRCS = getput_text.m4 \
          getput_var.m4 \
          getput_varn.m4 \

F90_SRCS = nfmpi_constants.f90 \
           nf90_constants.f90 \
           overloads.f90 \
           visibility.f90 \
           api.f90 \
           file.f90 \
           dims.f90 \
           attributes.f90 \
           variables.f90 \
           pnetcdf.f90

SRCS = $(F90_SRCS) $(M4_SRCS:.m4=.f90)

LIB_OBJS = pnetcdf.o

PACKING_LIST = $(F90_SRCS) \
               $(M4_SRCS) \
               Makefile.in \
               varn_interface.m4 \
               varnx_interface.m4

GARBAGE		= $(PNETCDF_MOD) $(M4_SRCS:.m4=.f90)
DIST_GARBAGE	=

all: $(MANUAL) $(PNETCDF_MOD) $(LIBRARY)

$(LIBRARY): $(LIB_OBJS)
	$(AR) $(ARFLAGS) $@ $(LIB_OBJS)
	$(RANLIB) $@

$(PNETCDF_MOD): $(SRCS)
	$(COMPILE.F90) $(srcdir)/pnetcdf.f90
	$(AR) $(ARFLAGS) $(LIBRARY) pnetcdf.o
	$(RANLIB) $(LIBRARY)

install: $(PNETCDF_MOD)
	$(INSTALL) -d -m 755 $(INCDIR)
	$(INSTALL_DATA) $(PNETCDF_MOD) $(INCDIR)

uninstall:
	$(RM) -f $(INCDIR)/$(PNETCDF_MOD)

include $(srcdir)/../../rules.make

