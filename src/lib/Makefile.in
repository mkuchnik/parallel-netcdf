#
# Copyright (C) 2012, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# Makefile for netcdf libsrc
#
# @configure_input@

srcdir = @srcdir@
VPATH  = @srcdir@

# generated by configure, so it's in the build dir, not srcdirr
include ../../macros.make

INCLUDES = -I. -I$(srcdir)

LIBRARY  = libpnetcdf.a
PROGRAM  = ncvalid
HEADER   = pnetcdf.h

M4_SRCS   = getput_var.m4 \
            getput_var1.m4 \
            getput_vara.m4 \
            getput_vars.m4 \
            getput_varm.m4 \
            i_getput_var.m4 \
            i_getput_var1.m4 \
            i_getput_vara.m4 \
            i_getput_vars.m4 \
            i_getput_varm.m4 \
            bput.m4 \
            getputn_schar.m4 \
            getputn_uchar.m4 \
            getputn_short.m4 \
            getputn_ushort.m4 \
            getputn_int.m4 \
            getputn_uint.m4 \
            getputn_float.m4 \
            getputn_double.m4 \
            getputn_int64.m4 \
            getputn_uint64.m4 \
            m_getput_varx.m4 \
            getput_varn.m4

LIB_CSRCS = mpinetcdf.c \
            header.c \
            mpincio.c \
            attr.c \
            dim.c \
            error.c \
            nc.c \
            ncx.c \
            string.c \
            var.c \
            ncmpidtype.c \
            convert_swap.c \
            filetype.c \
            nonblocking.c   \
            malloc.c \
            utf8proc.c \
            swap.c

PACKING_LIST = $(LIB_CSRCS) \
               $(M4_SRCS) \
               depend \
               fbits.h \
               Makefile \
               nc.h \
               ncconfig.in \
               ncio.h \
               ncx.h \
               pnetcdf.h \
               rnd.h \
               ncmpidtype.h \
               macro.h \
               utf8proc_data.h \
               utf8proc.h \
               varn_api_header.m4

LIB_OBJS   = $(LIB_CSRCS:.c=.o) $(M4_SRCS:.m4=.o)

PROG_CSRCS = validator.c

PROG_OBJS  = $(PROG_CSRCS:.c=.o)

GARBAGE    = $(LIBRARY) $(PROGRAM) $(M4_SRCS:.m4=.c) $(LIB_OBJS)

DIST_GARBAGE = ncconfig.h pnetcdf.h

all:  $(LIBRARY) $(PROGRAM)

$(LIBRARY): $(LIB_OBJS)
	$(AR) $(ARFLAGS) $@ $(LIB_OBJS)
	$(RANLIB) $@

install:
	$(INSTALL) -d -m 755 $(LIBDIR)
	$(INSTALL_DATA) $(LIBRARY) $(LIBDIR)/$(LIBRARY)
	$(INSTALL) -d -m 755 $(INCDIR)
	$(INSTALL_DATA) $(HEADER) $(INCDIR)/$(HEADER)
	$(INSTALL) -d -m 755 $(BINDIR)
	$(INSTALL) -m 755 $(PROGRAM) $(BINDIR)/$(PROGRAM)

uninstall:
	$(RM) -f $(LIBDIR)/$(LIBRARY)
	$(RM) -f $(INCDIR)/$(HEADER)
	$(RM) -f $(BINDIR)/$(PROGRAM)

$(PROGRAM): $(PROG_OBJS) $(LIB_OBJS)
	$(LINK.c) $(PROG_OBJS) $(LIB_OBJS)

include $(srcdir)/../../rules.make

.SUFFIXES: .ln
LINT = lint
LINT.c = $(LINT) $(LINTFLAGS) $(CPPFLAGS)
.c.ln:
	$(LINT.c) -c $<

llib-lpnetcdf.ln: $(LIB_CSRCS)
	$(LINT.c) $(LIB_CSRCS) -y -o pnetcdf

lint: llib-lpnetcdf.ln
	$(LINT.c) t_nc.c llib-lpnetcdf.ln

include $(srcdir)/depend
