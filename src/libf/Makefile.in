# $Id$
#
#	Makefile for netcdf libsrc
#

srcdir = @srcdir@
VPATH = @srcdir@
INSTALL = @INSTALL@

# generated by configure, so it's in the build dir, not srcdirr
include ../../macros.make

INCLUDES = -I. -I$(srcdir)/../lib -I../lib

LIBRARY 	= ../lib/libpnetcdf.a
PROGRAM		= 
ld_netcdf	= -L../lib -lpnetcdf

COMMON_HEADER_GENERATED	= pnetcdf_inc
HEADER_GENERATED	= pnetcdf.inc
MODULE_GENERATED        = pnetcdf.mod

MANUAL	= 

LIB_CSRCS = abortf.c begin_indep_dataf.c closef.c copy_attf.c \
	createf.c def_dimf.c def_varf.c del_attf.c enddeff.c \
	end_indep_dataf.c get_att_doublef.c get_att_realf.c \
	get_att_intf.c get_att_int1f.c get_att_int2f.c \
	get_att_textf.c get_var1_doublef.c \
	get_var1f.c get_var1_realf.c get_var1_intf.c get_var1_int2f.c \
	get_var1_textf.c get_vara_allf.c get_vara_double_allf.c \
	get_vara_doublef.c get_varaf.c get_vara_real_allf.c \
	get_vara_realf.c get_vara_int_allf.c get_vara_intf.c \
	get_var_allf.c get_vara_int2_allf.c get_vara_int2f.c \
	get_vara_text_allf.c get_vara_textf.c get_var_double_allf.c \
	get_var_doublef.c get_varf.c get_var_real_allf.c \
	get_var_realf.c get_var_int_allf.c get_var_intf.c get_vars_allf.c \
	get_vars_double_allf.c get_vars_doublef.c get_varsf.c \
	get_vars_real_allf.c get_vars_realf.c get_var_int2_allf.c \
	get_var_int2f.c get_vars_int_allf.c get_vars_intf.c \
	get_vars_int2_allf.c get_vars_int2f.c get_vars_text_allf.c \
	get_vars_textf.c get_var_text_allf.c get_var_textf.c \
	inq_attf.c inq_attidf.c inq_attlenf.c inq_attnamef.c \
	inq_atttypef.c inq_dimf.c inq_dimidf.c inq_dimlenf.c \
	inq_dimnamef.c inqf.c inq_nattsf.c inq_ndimsf.c inq_nvarsf.c \
	inq_unlimdimf.c inq_vardimidf.c inq_varf.c inq_varidf.c \
	inq_varnamef.c inq_varnattsf.c inq_varndimsf.c inq_vartypef.c \
        inq_formatf.c inq_file_formatf.c \
	openf.c put_att_doublef.c put_att_realf.c put_att_intf.c \
	put_att_int1f.c put_att_int2f.c put_att_textf.c \
	put_var1_doublef.c put_var1f.c put_var1_realf.c \
	put_var1_intf.c put_var1_int2f.c put_var1_textf.c put_vara_allf.c \
	put_vara_double_allf.c put_vara_doublef.c put_varaf.c \
	put_vara_real_allf.c put_vara_realf.c put_vara_int_allf.c \
	put_vara_intf.c put_vara_int2_allf.c put_vara_int2f.c \
	put_vara_text_allf.c put_vara_textf.c put_var_doublef.c put_varf.c \
	put_var_realf.c put_var_intf.c put_vars_allf.c \
	put_vars_double_allf.c put_vars_doublef.c put_varsf.c \
	put_vars_real_allf.c put_vars_realf.c put_var_int2f.c \
	put_vars_int_allf.c put_vars_intf.c put_vars_int2_allf.c \
	put_vars_int2f.c put_vars_text_allf.c put_vars_textf.c \
	put_var_textf.c redeff.c rename_attf.c rename_dimf.c \
	rename_varf.c syncf.c nfxutil.c xstrerrorf.c xinq_libversf.c\
	get_var1_int1f.c get_var_int1_allf.c \
	get_var_int1f.c \
	get_vara_int1_allf.c get_vara_int1f.c \
	get_vars_int1_allf.c get_vars_int1f.c \
	put_var1_int1f.c \
	put_var_int1f.c \
	put_vara_int1_allf.c put_vara_int1f.c \
	put_vars_int1_allf.c put_vars_int1f.c \
	get_varm_allf.c \
	get_varm_double_allf.c \
	get_varm_doublef.c \
	get_varmf.c \
	get_varm_int1_allf.c \
	get_varm_int1f.c \
	get_varm_int2_allf.c \
	get_varm_int2f.c \
	get_varm_int_allf.c \
	get_varm_intf.c \
	get_varm_real_allf.c \
	get_varm_realf.c \
	get_varm_text_allf.c \
	get_varm_textf.c \
	put_varm_allf.c \
	put_varm_double_allf.c \
	put_varm_doublef.c \
	put_varmf.c \
	put_varm_int1_allf.c \
	put_varm_int1f.c \
	put_varm_int2_allf.c \
	put_varm_int2f.c \
	put_varm_int_allf.c \
	put_varm_intf.c \
	put_varm_real_allf.c \
	put_varm_realf.c \
	put_varm_text_allf.c \
	put_varm_textf.c \
	set_fillf.c \
	set_default_formatf.c \
	issyserrf.c \
	get_file_infof.c \
	deletef.c \
	iput_vara_allf.c \
	iput_vara_int1_allf.c \
	iput_vara_text_allf.c \
	iput_vara_int2_allf.c \
	iput_vara_int_allf.c \
	iput_vara_real_allf.c \
	iput_vara_double_allf.c \
	iget_vara_allf.c \
	iget_vara_int1_allf.c \
	iget_vara_text_allf.c \
	iget_vara_int2_allf.c \
	iget_vara_int_allf.c \
	iget_vara_real_allf.c \
	iget_vara_double_allf.c \
	waitallf.c \
	wait_allf.c \
	waitf.c \
	wait_onef.c \
	mvar.c

LIB_FSRCS = strerrorf.f inq_libversf.f
PACKING_LIST = \
	$(LIB_CSRCS) $(LIB_FSRCS)\
	Makefile 

LIB_OBJS = $(LIB_CSRCS:.c=.o) $(LIB_FSRCS:.f=.o)

# Empty values for PROG_CSRCS cause problems for some makes
#PROG_CSRCS = 
#
#PROG_OBJS = $(PROG_CSRCS:.c=.o)

GARBAGE		= pnetcdf.F90 $(MODULE_GENERATED) $(HEADER_GENERATED)

DIST_GARBAGE	= $(COMMON_HEADER_GENERATED) nfconfig.inc


all:		$(LIBRARY) $(MANUAL) $(PROGRAM) $(MODULE_GENERATED) $(HEADER_GENERATED)

$(MODULE_GENERATED): $(COMMON_HEADER_GENERATED) pnetcdf_api.interface
	/bin/rm -f pnetcdf.F90
	echo "! This file is automatically generated at configure time. Do not edit." > pnetcdf.F90
	echo "" >> pnetcdf.F90
	echo "module pnetcdf" >> pnetcdf.F90
	/bin/cat $(COMMON_HEADER_GENERATED) $(srcdir)/pnetcdf_api.interface >> pnetcdf.F90
	echo "end module pnetcdf" >> pnetcdf.F90
	$(COMPILE.F90) pnetcdf.F90

$(HEADER_GENERATED): $(COMMON_HEADER_GENERATED) pnetcdf_api.external
	/bin/rm -f pnetcdf.inc
	/bin/cat $(COMMON_HEADER_GENERATED) $(srcdir)/pnetcdf_api.external > pnetcdf.inc

install:	$(INCDIR)/$(HEADER_GENERATED)  $(INCDIR)/$(MODULE_GENERATED)

uninstall:

# An empty value for the variable PROGRAM causes some makes to fail
#$(PROGRAM):	$(PROG_OBJS)
#	$(LINK.c) $(PROG_OBJS) $(LIBS)

include $(srcdir)/../../rules.make

.SUFFIXES: .ln
LINT = lint
LINT.c = $(LINT) $(LINTFLAGS) $(CPPFLAGS)
.c.ln:
	$(LINT.c) -c $<

llib-lnetcdf.ln: $(LIB_CSRCS)
	$(LINT.c) $(LIB_CSRCS) -y -o netcdf

lint: llib-lnetcdf.ln
	$(LINT.c) t_nc.c llib-lnetcdf.ln

# i nclude $(srcdir)/depend
