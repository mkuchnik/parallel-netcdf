#
# Copyright (C) 2012, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH  = @srcdir@

include ../../macros.make

INCLUDES  = -I../../src/lib -I$(srcdir)/../common
FPPFLAGS += -I../../src/libf
LDFLAGS  += -L../../src/lib
LIBS     += -lpnetcdf $(MATHLIB)

C_SRCS   = mcoll_perf.c \
           test_bput.c

F90_SRCS = mcoll_testf.f90 \
           test_bputf.f90

PROGS     = $(C_SRCS:.c=)
OBJS      = $(C_SRCS:.c=.o)
ifeq (@has_fortran@, yes)
PROGS     += $(F90_SRCS:.f90=)
OBJS      += $(F90_SRCS:.f90=.o)
endif

GARBAGE      = $(PROGS) *.nc
PACKING_LIST = $(C_SRCS) $(F90_SRCS) Makefile.in README

all: $(PROGS)

mcoll_perf: mcoll_perf.o $(LIBRARY)
	$(LINK.c) $< $(LDFLAGS) $(LIBS)

test_bput: test_bput.o $(LIBRARY)
	$(LINK.c) $< $(LDFLAGS) $(LIBS)

mcoll_testf: mcoll_testf.o $(LIBRARY)
	$(LINK.F) $< $(LDFLAGS) $(LIBS)

test_bputf: test_bputf.o $(LIBRARY)
	$(LINK.F) $< $(LDFLAGS) $(LIBS)

check testing: $(PROGS)
	./mcoll_perf
	./test_bput
ifeq (@has_fortran@, yes)
	./mcoll_testf
	./test_bputf
endif

verbose_check verbose_testing: $(PROGS)
	./mcoll_perf -v
	./test_bput -v
ifeq (@has_fortran@, yes)
	./mcoll_testf -v
	./test_bputf -v
endif

include $(srcdir)/../../rules.make

