#
# Copyright (C) 2014, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir	= @srcdir@
VPATH	= @srcdir@

include ../../macros.make

INCLUDES  = -I../../src/lib -I../../src/libcxx
LIBS     := $(LIBRARY) $(LIBS) @LCOV_LIB@

SRCS    = nctst.cpp \
          test_classic.cpp

OBJS    = $(SRCS:.cpp=.o)
PROGS   = $(SRCS:.cpp=)

PAR_PROGS =

GARBAGE      = $(PROGS) *.nc
PACKING_LIST = $(SRCS) Makefile.in

all: $(PROGS)

nctst.o: nctst.cpp 

nctst: nctst.o $(LIBRARY) $(LIBRARY)
	$(LINK.cxx) $< $(LDFLAGS) $(LIBS)

test_classic.o: test_classic.cpp 

test_classic: test_classic.o $(LIBRARY)
	$(LINK.cxx) $< $(LDFLAGS) $(LIBS)

check testing verbose_testing: $(PROGS)
	$(TEST_SEQRUN) ./nctst        $(TEST_OUTDIR)/testfile.nc
	$(TEST_SEQRUN) ./test_classic $(TEST_OUTDIR)/testfile.nc


ptest: $(PAR_PROGS)
	@for i in $(PAR_PROGS); do ( \
	$(TEST_MPIRUN) -n 4 ./$$i $(TEST_OUTDIR)/testfile.nc \
	; ) ; done

include $(srcdir)/../../rules.make

$(LIBRARY): ;

