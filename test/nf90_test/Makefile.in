#
# Copyright (C) 2003, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH  = @srcdir@

include ../../macros.make

INCLUDES  = -I../../src/lib -I$(srcdir) -I$(srcdir)/../../src/libf
INCLUDES += @FC_MODINC@../../src/libf90
LDFLAGS  += -L../../src/lib
LIBS     += -lpnetcdf @LCOV_LIB@

M4SRCS      = test_get.m4 \
              test_put.m4  \
              test_iget.m4 \
              test_iput.m4

M4SRCS_F90  = $(M4SRCS:.m4=.F90)

F90_SRCS    = nf90_error.F90 \
              nf90_test.F90 \
              test_read.F90 \
              test_write.F90 \
              util.F90

C_SRCS      = fortlib.c

HEADERS     = tests.inc

C_OBJS   = $(C_SRCS:.c=.o)
F90_OBJS = $(F90_SRCS:.F90=.o) $(M4SRCS_F90:.F90=.o)
OBJS     = $(C_OBJS) $(F90_OBJS)

PROGS    = nf90_test

GARBAGE  = $(PROGS) $(M4SRCS_F90) \
           scratch.nc test.nc

PACKING_LIST = $(C_SRCS) $(F90_SRCS) $(M4SRCS) $(HEADERS) depend Makefile.in README

all: $(PROGS)

nf90_test: $(OBJS) $(LIBRARY)
	$(LINK.F90) $(OBJS) $(LDFLAGS) $(LIBS)

tags: $(F90_SRCS) $(C_SRCS) FORCE
	ctags -t $(F90_SRCS) $(C_SRCS) ../fortran/*.c ../libsrc/*.c

# This simple testing target ensures that the test files are present
testing check: all
	$(RM) -f scratch.nc test.nc
	./nf90_test -c    && ./nf90_test
	./nf90_test -c -2 && ./nf90_test -2
	./nf90_test -c -5 && ./nf90_test -5

verbose_testing: all
	$(RM) -f scratch.nc test.nc
	./nf90_test -v -c    && ./nf90_test -v
	./nf90_test -v -c -2 && ./nf90_test -v -2
	./nf90_test -v -c -5 && ./nf90_test -v -5

#test.nc: 
#	(cd ../nc_test && $(MAKE) $(MFLAGS) nc_test && ./nc_test -c)
#	cp ../nc_test/test.nc .

include $(srcdir)/../../rules.make
include $(srcdir)/depend
