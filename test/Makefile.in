#
# Copyright (C) 2003, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH = @srcdir@

include ../macros.make

SUBDIRS = common \
          nc_test \
          test_int \
          test_float \
          test_double \
          test_double_int \
          test_dtype \
          C \
          fandc \
          largefile \
          nonblocking \
          cdf_format \
          header \
          testcases \
          data

ifeq (@has_fortran@, yes)
SUBDIRS += nf_test
SUBDIRS += nf90_test
SUBDIRS += F90
endif

ifeq (@enable_subfiling@, yes)
SUBDIRS += subfile
endif

# Packing subdirs must include all directories
# thus, configure must enable fortran and subfiling in order to run "make dist"
PACKING_SUBDIRS = $(SUBDIRS)

PACKING_LIST = Makefile.in

all:
	set -e; for i in $(SUBDIRS); do ( cd $$i && $(MAKE) $(MFLAGS) all ; ) ; done

# Eventually, this target will run all of the relevant tests
check testing: all
	cd nc_test && $(MAKE) $(MFLAGS) testing
	if [ @has_fortran@ = yes ] ; then cd nf_test   && $(MAKE) $(MFLAGS) testing ; fi
	if [ @has_fortran@ = yes ] ; then cd nf90_test && $(MAKE) $(MFLAGS) testing ; fi
	if [ @has_fortran@ = yes ] ; then cd F90       && $(MAKE) $(MFLAGS) testing ; fi
	cd C && $(MAKE) $(MFLAGS) testing
	cd nonblocking && $(MAKE) $(MFLAGS) testing
	cd testcases && $(MAKE) $(MFLAGS) testing
	cd cdf_format && $(MAKE) $(MFLAGS) testing

verbose_check verbose_testing: all
	cd nc_test && $(MAKE) $(MFLAGS) verbose_testing
	if [ @has_fortran@ = yes ] ; then cd nf_test   && $(MAKE) $(MFLAGS) verbose_testing ; fi
	if [ @has_fortran@ = yes ] ; then cd nf90_test && $(MAKE) $(MFLAGS) verbose_testing ; fi
	if [ @has_fortran@ = yes ] ; then cd F90       && $(MAKE) $(MFLAGS) verbose_testing ; fi
	cd C && $(MAKE) $(MFLAGS) verbose_testing
	cd nonblocking && $(MAKE) $(MFLAGS) verbose_testing
	cd testcases && $(MAKE) $(MFLAGS) verbose_testing
	cd cdf_format && $(MAKE) $(MFLAGS) verbose_testing

ptest: all
	if [ @has_fortran@ = yes ] ; then cd F90 && $(MAKE) $(MFLAGS) ptest ; fi
	cd C && $(MAKE) $(MFLAGS) ptest
	cd nonblocking && $(MAKE) $(MFLAGS) ptest
	cd testcases && $(MAKE) $(MFLAGS) ptest
	cd header && $(MAKE) $(MFLAGS) ptest
	if [ @enable_subfiling@ = yes ] ; then cd subfile && $(MAKE) $(MFLAGS) ptest ; fi

include $(srcdir)/../rules.make

