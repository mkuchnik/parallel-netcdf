#
#   Copyright (C) 2003, Northwestern University and Argonne National Laboratory
#   See COPYRIGHT notice in top-level directory.
#
# $Id$

srcdir = @srcdir@
VPATH  = @srcdir@

include ../../macros.make

INCLUDES  = -I../../src/lib -I$(srcdir)/../common -I$(srcdir)
LDFLAGS  += -L../../src/lib -L../common
LIBS     += -ltestutils -lpnetcdf $(MATHLIB)

SRCS      = nc_test.c \
            error.c \
            test_get.c \
            test_put.c \
            test_read.c \
            test_write.c \
            test_iget.c \
            test_iput.c \
            util.c

OBJS      = $(SRCS:.c=.o)

PROGS     = nc_test

time_log  = times

GARBAGE      = $(PROGS) test.nc scratch.nc lint.out \
               $(time_log) test_get.c test_put.c test_iget.c test_iput.c

PACKING_LIST = $(SRCS) \
               test_get.m4 \
               test_put.m4 \
               test_iget.m4 \
               test_iput.m4 \
               error.h \
               tests.h \
               Makefile.in \
               depend \
               README

all: $(PROGS)

test: nc_test test.nc
	./nc_test
	@echo '*** Success ***'

readonly: nc_test test.nc
	./nc_test -r

test.nc:  nc_test
	./nc_test -c

nc_test: $(OBJS) $(LIBRARY)
	$(LINK.c) $(OBJS) $(LDFLAGS) $(LIBS)

test_get.c: test_get.m4

test_put.c: test_put.m4

test_iget.c: test_iget.m4

test_iput.c: test_iput.m4

nctime: nctime.o $(LIBRARY)
	$(LINK.c) $< $(LDFLAGS) $(LIBS)

time: nctime
	time ./nctime 24 13 19 17 > $(time_log)
	$(AWK) -f timesum.awk < $(time_log)

saber_src:
	#load -C $(CPPFLAGS) $(SRCS) $(ld_pnetcdf) $(ld_math) $(LIBS)

# This simple testing target ensures that the test files are present
testing: test.nc nc_test
	$(RM) -f scratch.nc
	./nc_test && ./nc_test -c -2 && ./nc_test

verbose_testing: test.nc nc_test
	$(RM) -f scratch.nc
	./nc_test -v && ./nc_test -c -v -2 && ./nc_test -v

include $(srcdir)/../../rules.make
include $(srcdir)/depend
