#
# Copyright (C) 2003, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# $Id$
#
# @configure_input@

srcdir = @srcdir@
VPATH  = @srcdir@

include ../../macros.make

INCLUDES  = -I../../src/lib -I$(srcdir)/../common -I$(srcdir)
LDFLAGS  += -L../../src/lib -L../common
LIBS     += -lpnetcdf $(MATHLIB) @LCOV_LIB@

SRCS      = nc_test.c \
            test_read.c \
            test_write.c \
            error.c \
            util.c

M4_SRCS   = test_get.m4 \
            test_put.m4 \
            test_iget.m4 \
            test_iput.m4

HEADERS   = tests.h \
            error.h

OBJS      = $(SRCS:.c=.o) $(M4_SRCS:.m4=.o)

PROGS     = nc_test

GARBAGE      = $(PROGS) $(M4_SRCS:.m4=.c) \
               test.nc scratch.nc

PACKING_LIST = $(SRCS) $(M4_SRCS) $(HEADERS) Makefile.in depend README

all: $(PROGS)

nc_test: $(OBJS) $(LIBRARY)
	$(LINK.c) $(OBJS) $(LDFLAGS) $(LIBS)

# This simple testing target ensures that the test files are present
check testing: all
	$(RM) -f scratch.nc test.nc
	./nc_test -c    && ./nc_test
	./nc_test -c -2 && ./nc_test -2
	./nc_test -c -5 && ./nc_test -5

verbose_testing: all
	$(RM) -f scratch.nc test.nc
	./nc_test -c -v    && ./nc_test -v
	./nc_test -c -v -2 && ./nc_test -v -2
	./nc_test -c -v -5 && ./nc_test -v -5

include $(srcdir)/../../rules.make
include $(srcdir)/depend

