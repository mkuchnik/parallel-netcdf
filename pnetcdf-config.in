#! /bin/sh
#
# Copyright (C) 2016, Northwestern University and Argonne National Laboratory
# See COPYRIGHT notice in top-level directory.
#
# This forms the basis for the pnetcdf-config utility, which tells you
# various things about the PnetCDF installation. This code was based on
# file nc-config.in from netCDF distribution.
#
# $Id$
#
# @configure_input@

prefix="@prefix@"
exec_prefix="@exec_prefix@"
libdir="@libdir@"
includedir="@includedir@"

# Preprocessing:
FC_DEFINE="@FC_DEFINE@"
CPP="@CPP@"
FPP="@FPP@"

if test "x@PNETCDF_DEBUG@" = x1 ; then
  CPPFLAGS="@CPPFLAGS@ -DPNETCDF_DEBUG"
  CXXCPPFLAGS="@CXXCPPFLAGS@ -DPNETCDF_DEBUG"
  FPPFLAGS="@FPPFLAGS@ @NAGf90FPPFLAGS@ @FC_DEFINE@PNETCDF_DEBUG"
else
  CPPFLAGS="@CPPFLAGS@"
  CXXCPPFLAGS="@CXXCPPFLAGS@"
  FPPFLAGS="@FPPFLAGS@ @NAGf90FPPFLAGS@"
fi

# Compilation:
MPICC="@MPICC@"
MPICXX="@MPICXX@"
MPIF77="@MPIF77@"
MPIF90="@MPIF90@"

# debugging and optimization options for compiling and linking
CFLAGS="@CFLAGS@"
CXXFLAGS="@CXXFLAGS@"
F77FLAGS="@F77FLAGS@ @NAG_FCFLAGS@"
F90FLAGS="@F90FLAGS@ @NAG_FCFLAGS@"

# Linking:
FLIBS="@FLIBS@"
FCLIBS="@FCLIBS@"
F90LIBS="@F90LIBS@"
FLDFLAGS="@FLDFLAGS@"
F90LDFLAGS="@F90LDFLAGS@"
LDFLAGS="@LDFLAGS@ -L${libdir}"
LIBS="@LIBS@"

version="@PACKAGE_NAME@ @PNETCDF_VERSION@"
CC=${MPICC}
F77=${MPIF77}
F90=${MPIF90}
CFLAGS="-I${includedir} ${CFLAGS}"
LIBS="-lpnetcdf ${LIBS}"

has_fortran="@has_fortran@"
has_cxx="@has_mpicxx@"

usage()
{
    cat <<EOF
Usage: pnetcdf-config [OPTION]

Available values for OPTION include:

  --help        display this help message and exit
  --all         display all options
  --cc          C compiler
  --cflags      C compiler flags
  --cppflags    C pre-processor flags
  --has-c++     whether C++ API is installed
  --c++         C++ compiler
  --cxxflags    C++ compiler flags
  --cxxppflags  C++ pre-processor flags
  --has-fortran whether Fortran API is installed
  --f77         Fortran 77 compiler
  --f77flags    Fortran 77 compiler flags
  --f77libs     Fortran 77 linker libraries
  --fppflags    Fortran pre-processor flags
  --f90         Fortran 90 compiler
  --f90flags    Fortran 90 compiler flags
  --f90libs     Fortran 90 linker libraries
  --ldflags     Linker options
  --libs        library linking information for PnetCDF
  --prefix      Install prefix
  --includedir  Include directory
  --libdir      Library directory
  --version     Library version
EOF
    exit $1
}

all()
{
        echo
        echo "This $version has been built with the following features: "
        echo
        echo "  --cc                -> $MPICC"
        echo "  --cflags            -> $CFLAGS"
        echo "  --cppflags          -> $CPPFLAGS"
        echo "  --ldflags           -> $LDFLAGS"
        echo "  --libs              -> $LIBS"
        echo
        echo "  --has-c++           -> $has_cxx"
if test "x$has_cxx" = xyes ; then
        echo "  --cxx               -> $MPICXX"
        echo "  --cxxflags          -> $CXXFLAGS"
        echo "  --cxxppflags        -> $CXXCPPFLAGS"
fi
        echo
        echo "  --has-fortran       -> $has_fortran"
if test "x$has_fortran" = xyes ; then
        echo "  --f77               -> $MPIF77"
        echo "  --f77flags          -> $F77FLAGS"
        echo "  --fppflags          -> $FPPFLAGS"
        echo "  --f77libs           -> $FCLIBS"
        echo
        echo "  --f90               -> $MPIF90"
        echo "  --f90flags          -> $F90FLAGS"
        echo "  --f90libs           -> $F90LIBS"
fi
        echo
if test "x${enable_erange_fill}" = xno; then
        echo "  --erange-fill       -> disabled"
        echo
fi
if test "x@ENABLE_SUBFILING@" = xyes; then
        echo "  --subfiling         -> enabled"
        echo
fi
if test "x@RELAX_COORD_BOUND@" = xyes; then
        echo "  --relax-coord-bound -> enabled"
        echo
fi
if test "x@is_bigendian@" = xno  && (test "x@in_place_swap@" = xno) ; then
        echo "  --in-place-swap     -> disabled"
        echo
fi
if test "x@PNETCDF_DEBUG@" = xyes; then
        echo "  --debug             -> enabled"
        echo
fi
        echo "  --prefix            -> $prefix"
        echo "  --includedir        -> $includedir"
        echo "  --libdir            -> $libdir"
        echo "  --version           -> $version"
}

if test $# -eq 0; then
    usage 1
fi

while test $# -gt 0; do
    case "$1" in
    # this deals with options in the style
    # --option=value and extracts the value part
    # [not currently used]
    -*=*) value=`echo "$1" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
    *) value= ;;
    esac

    case "$1" in

    --help)
        usage 0
        ;;

    --all)
        all
        ;;

    --cc)
        echo $cc
        ;;

    --cflags)
        echo $cflags
        ;;

    --cppflags)
        echo $CPPFLAGS
        ;;

     --libs)
       echo $libs
       ;;

    --prefix)
       echo "${prefix}"
       ;;

    --includedir)
       echo "${includedir}"
       ;;

    --libdir)
       echo "${libdir}"
       ;;

    --ldflags)
       echo "${LDFLAGS}"
       ;;

    --libs)
       echo "${LIBS}"
       ;;

    --version)
        echo $version
        ;;

    --has-c++)
        echo $has_cxx
        ;;

    --cxx)
        echo $cxx
        ;;

    --cxxflags)
        echo $cxxflags
        ;;

    --cxxppflags)
        echo $CXXCPPFLAGS
        ;;

    --has-fortran)
        echo $has_fortran
        ;;

    --f77)
        echo $f77
        ;;

    --f77flags)
        echo $f77flags
        ;;

    --fppflags)
        echo $FPPFLAGS
        ;;

    --f77libs)
        echo $FCLIBS
        ;;

    --f90)
        echo $f90
        ;;

    --f90flags)
        echo $f90flags
        ;;

    --f90libs)
        echo $F90LIBS
        ;;

    *)
        echo "unknown option: $1"
        usage 1
        ;;
    esac
    shift
done

exit 0
